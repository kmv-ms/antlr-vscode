export class ParseTreeRenderer {
    duration = 200;
    width = 1000;
    height = 1000;
    nodeSizeFactor = 1;
    nodeWidth = 60;
    nodeHeight = 190;
    rectW = 180;
    rectH = 23;
    root;
    svg;
    topGroup;
    zoom;
    cluster;
    tree;
    nodeSelection;
    linkSelection;
    data;
    constructor() {
        this.svg = d3.select("svg")
            .attr("xmlns", "http://www.w3.org/2000/svg")
            .attr("version", "1.1")
            .attr("viewBox", `0 0 ${this.width} ${this.height}`);
        this.topGroup = this.svg.append("g");
        this.zoom = d3.zoom()
            .scaleExtent([0.01, 3])
            .on("zoom", (event) => {
            this.topGroup.attr("transform", event.transform.toString());
        });
        this.tree = d3.tree()
            .nodeSize([this.nodeWidth, this.nodeHeight])
            .separation((a, b) => {
            return a.parent === b.parent ? 1 : 1.4;
        });
        this.cluster = d3.cluster()
            .nodeSize([this.nodeWidth, this.nodeHeight])
            .separation((a, b) => {
            return a.parent === b.parent ? 1 : 1.4;
        });
    }
    get transform() {
        return this.topGroup.attr("transform");
    }
    loadNewTree(data) {
        this.data = {
            horizontal: true,
            useCluster: false,
            initialTranslateX: 200,
            initialTranslateY: 400,
            initialScale: 0.75,
            ...this.data,
            ...data,
        };
        this.svg.call(this.zoom)
            .call(this.zoom.transform, d3.zoomIdentity
            .translate(this.data.initialTranslateX - this.rectW / 2, this.data.initialTranslateY)
            .scale(this.data.initialScale))
            .on("dblclick.zoom", null);
        this.nodeWidth = this.data.horizontal ? 60 : 190;
        this.nodeHeight = this.data.horizontal ? 190 : 60;
        const x0 = this.root?.data.x0 ?? this.width / 2;
        const y0 = this.root?.data.y0 ?? this.height / 2;
        this.root = d3.hierarchy(this.data.parseTreeData, (node) => {
            return node.children;
        });
        if (this.data.useCluster) {
            this.cluster(this.root);
        }
        else {
            this.tree(this.root);
        }
        this.root.data.x0 = x0;
        this.root.data.y0 = y0;
        this.updateLayouts();
        this.update(this.root);
    }
    changeNodeSize(factor) {
        if (this.data) {
            this.nodeSizeFactor *= factor;
            if (this.data.horizontal) {
                this.tree.nodeSize([this.nodeWidth, this.nodeHeight * this.nodeSizeFactor]);
                this.cluster.nodeSize([this.nodeWidth, this.nodeHeight * this.nodeSizeFactor]);
                this.rectW = 0.9 * this.nodeHeight * this.nodeSizeFactor;
            }
            else {
                this.tree.nodeSize([this.nodeWidth * this.nodeSizeFactor, this.nodeHeight]);
                this.cluster.nodeSize([this.nodeWidth * this.nodeSizeFactor, this.nodeHeight]);
                this.rectW = 0.9 * this.nodeWidth * this.nodeSizeFactor;
            }
            this.applyLayoutChanges(0.5);
        }
    }
    toggleOrientation(checkbox) {
        if (this.data) {
            this.data.horizontal = !checkbox.checked;
            this.nodeWidth = this.data.horizontal ? 60 : 190;
            this.nodeHeight = this.data.horizontal ? 190 : 60;
            if (this.data.horizontal) {
                this.tree.nodeSize([this.nodeWidth, this.nodeHeight * this.nodeSizeFactor]);
                this.cluster.nodeSize([this.nodeWidth, this.nodeHeight * this.nodeSizeFactor]);
            }
            else {
                this.tree.nodeSize([this.nodeWidth * this.nodeSizeFactor, this.nodeHeight]);
                this.cluster.nodeSize([this.nodeWidth * this.nodeSizeFactor, this.nodeHeight]);
            }
            this.applyLayoutChanges(1);
        }
    }
    toggleTreeType(checkbox) {
        if (this.data) {
            this.data.useCluster = checkbox.checked;
            this.applyLayoutChanges(0.5);
        }
    }
    initSwitches() {
        const switch1 = document.getElementById("switch1");
        if (switch1) {
            switch1.checked = this.data?.useCluster ?? false;
        }
        const switch2 = document.getElementById("switch2");
        if (switch2) {
            switch2.checked = !this.data?.horizontal ?? true;
        }
    }
    update(parent) {
        if (!this.data || !this.root) {
            return;
        }
        const size = this.cluster.nodeSize() ?? [0, 0];
        this.rectW = (this.data.horizontal ? size[1] : size[0]) * 0.9;
        const layoutNodes = this.root.descendants();
        this.nodeSelection = this.topGroup.selectAll(".tree-node")
            .data(layoutNodes, (node) => {
            return node.data.id;
        });
        const nodeEnter = this.nodeSelection.enter().append("g")
            .attr("class", (d) => {
            if (!d.parent) {
                return "tree-node tree-root";
            }
            let result = "tree-node";
            switch (d.data.type) {
                case "terminal": {
                    result += " tree-leaf";
                    break;
                }
                case "error": {
                    result += " tree-error";
                    break;
                }
                default:
            }
            return result;
        })
            .attr("transform", () => {
            if (this.data?.horizontal) {
                return `translate(${parent.data.y0 ?? 0}, ${parent.data.x0 ?? 0})`;
            }
            return `translate(${parent.data.x0 ?? 0}, ${parent.data.y0 ?? 0})`;
        })
            .style("opacity", 0)
            .on("click", this.click);
        nodeEnter.append("rect")
            .attr("width", this.rectW)
            .attr("height", this.rectH)
            .attr("rx", (d) => {
            return (d.data.type === "rule") ? 0 : 10;
        })
            .attr("ry", (d) => {
            return (d.data.type === "rule") ? 0 : 10;
        });
        this.createText(nodeEnter);
        this.updateExistingNodes(1);
        this.nodeSelection
            .transition()
            .duration(this.duration)
            .attr("transform", (node) => {
            if (this.data?.horizontal) {
                return `translate(${node.y}, ${node.x})`;
            }
            return `translate(${node.x}, ${node.y})`;
        })
            .style("opacity", 1);
        nodeEnter.attr("transform", (node) => {
            if (this.data?.horizontal) {
                return `translate(${node.y ?? 0}, ${node.x ?? 0})`;
            }
            return `translate(${node.x ?? 0}, ${node.y ?? 0})`;
        });
        nodeEnter.transition()
            .duration(this.duration * 2)
            .style("opacity", 1);
        this.nodeSelection.exit().transition()
            .duration(this.duration)
            .style("opacity", 0)
            .remove();
        this.linkSelection = this.topGroup.selectAll(".tree-link")
            .data(layoutNodes.slice(1), (node) => {
            return node.data.id;
        });
        const linkEnter = this.linkSelection.enter().insert("path", "g")
            .attr("class", "tree-link")
            .attr("d", this.computeLinks)
            .style("stroke-opacity", 0);
        this.linkSelection
            .transition()
            .duration(this.duration)
            .attr("d", this.computeLinks).style("stroke-opacity", 1);
        linkEnter
            .transition()
            .duration(this.duration * 2)
            .style("stroke-opacity", 1);
        this.linkSelection.exit()
            .transition()
            .duration(this.duration)
            .style("stroke-opacity", 0)
            .remove();
        this.nodeSelection = this.topGroup.selectAll(".tree-node");
        this.linkSelection = this.topGroup.selectAll(".tree-link");
        layoutNodes.forEach((node) => {
            node.data.x0 = node.x;
            node.data.y0 = node.y;
        });
    }
    updateLayouts() {
        if (this.data) {
            if (this.data.horizontal) {
                this.rectW = this.nodeHeight * this.nodeSizeFactor;
                this.tree.nodeSize([this.nodeWidth, this.rectW]);
                this.cluster.nodeSize([this.nodeWidth, this.rectW]);
            }
            else {
                this.rectW = this.nodeWidth * this.nodeSizeFactor;
                this.tree.nodeSize([this.rectW, this.nodeHeight]);
                this.cluster.nodeSize([this.rectW, this.nodeHeight]);
            }
        }
    }
    applyLayoutChanges(durationFactor) {
        if (!this.data || !this.root) {
            return;
        }
        if (this.data.useCluster) {
            this.cluster(this.root);
        }
        else {
            this.tree(this.root);
        }
        this.updateExistingNodes(durationFactor);
        this.nodeSelection
            .transition()
            .duration(this.duration * durationFactor)
            .attr("transform", (node) => {
            if (this.data?.horizontal ?? true) {
                return `translate(${node.y ?? 0}, ${node.x ?? 0})`;
            }
            return `translate(${node.x ?? 0}, ${node.y ?? 0})`;
        });
        this.linkSelection
            .transition()
            .duration(this.duration * durationFactor)
            .attr("d", this.computeLinks);
    }
    updateExistingNodes(durationFactor) {
        this.nodeSelection
            .transition()
            .duration(this.duration * durationFactor)
            .attr("class", (d) => {
            if (!d.parent) {
                return "tree-node tree-root";
            }
            let result = "tree-node";
            switch (d.data.type) {
                case "terminal": {
                    result += " tree-leaf";
                    break;
                }
                case "error": {
                    result += " tree-error";
                    break;
                }
                default:
            }
            return result;
        });
        const rectW = this.rectW;
        this.nodeSelection.select("rect")
            .transition()
            .duration(this.duration * durationFactor)
            .attr("width", rectW);
        this.nodeSelection.select(".node-text")
            .transition()
            .duration(this.duration * durationFactor)
            .attr("x", function () {
            return (rectW - this.getComputedTextLength()) / 2;
        });
        const isHorizontal = this.data?.horizontal ?? true;
        this.nodeSelection.select(".token-value")
            .transition()
            .duration(this.duration * durationFactor)
            .attr("dx", function () {
            return isHorizontal ? rectW + 20 : (rectW - this.getComputedTextLength()) / 2;
        })
            .attr("dy", () => {
            return isHorizontal ? "0.25em" : "2.5em";
        })
            .text((d) => {
            if (d.data.type === "rule") {
                return "";
            }
            if (d.data.type === "error") {
                if (!d.data.symbol || d.data.symbol.tokenIndex === -1) {
                    return "<missing>";
                }
                return `<unexpected: ${d.data.symbol.text}>`;
            }
            return d.data.symbol?.text ?? "";
        });
        this.nodeSelection.select(".token-range")
            .transition()
            .duration(this.duration * durationFactor)
            .text((d) => {
            if (d.data.type !== "rule") {
                if (!d.data.symbol || d.data.symbol.tokenIndex === -1) {
                    return "no index";
                }
                return `\u2A33 ${d.data.symbol.tokenIndex}`;
            }
            if (!d.data.range || d.data.range.length === 0) {
                return "\u2A33 --";
            }
            if (d.data.range.length === 1) {
                return `\u2A33 ${d.data.range.startIndex}`;
            }
            return `\u2A33 ${d.data.range.startIndex}-${d.data.range.stopIndex}`;
        });
    }
    click = (_event, node) => {
        if (node.children) {
            node.data.childrenBackup = node.children;
            node.children = undefined;
        }
        else {
            node.children = node.data.childrenBackup;
            node.data.childrenBackup = undefined;
        }
        if (this.data && this.root) {
            if (this.data.useCluster) {
                this.cluster(this.root);
            }
            else {
                this.tree(this.root);
            }
            this.update(node);
        }
    };
    createText(nodeEnter) {
        let nodeText = nodeEnter.append("text")
            .attr("class", "node-text")
            .attr("y", this.rectH / 2)
            .attr("dy", ".35em")
            .text((node) => {
            return node.data.name;
        });
        nodeText.attr("x", (node, index, list) => {
            return (this.rectW - list[index].getComputedTextLength()) / 2;
        });
        nodeEnter.append("text")
            .attr("class", "token-range")
            .attr("x", 0)
            .attr("y", this.rectH / 2)
            .attr("dx", 0)
            .attr("dy", "-1.8em")
            .text((node) => {
            if (node.data.type !== "rule") {
                if (node.data.symbol?.tokenIndex === -1) {
                    return "no index";
                }
                return `\u2A33 ${node.data.symbol?.tokenIndex ?? -1}`;
            }
            if (!node.data.range || node.data.range.length === 0) {
                return "\u2A33 --";
            }
            if (node.data.range.length === 1) {
                return `\u2A33 ${node.data.range.startIndex}`;
            }
            return `\u2A33 ${node.data.range.startIndex} - ${node.data.range.stopIndex}`;
        });
        nodeText = nodeEnter.append("text")
            .attr("class", "token-value")
            .attr("x", 0)
            .attr("y", this.rectH / 2)
            .attr("dy", this.data?.horizontal ?? true ? "0.25em" : "2.5em")
            .text((node) => {
            if (node.data.type === "rule") {
                return "";
            }
            if (node.data.type === "error") {
                if (!node.data.symbol || node.data.symbol.tokenIndex === -1) {
                    return "<missing>";
                }
                return `<unexpected: ${node.data.symbol.text}>`;
            }
            return node.data.symbol?.text ?? "";
        });
        nodeText.attr("dx", (node, index, list) => {
            return this.data?.horizontal ?? true
                ? this.rectW + 20
                : (this.rectW - list[index].getComputedTextLength()) / 2;
        });
    }
    computeLinks = (node) => {
        const parentX = node.parent?.x ?? 0;
        const parentY = node.parent?.y ?? 0;
        const nodeX = node.x;
        const nodeY = node.y;
        if (this.data?.horizontal ?? true) {
            const y = parentY + this.rectW / 2;
            return `M${nodeY},${(nodeX + this.rectH / 2)}C${y},${(nodeX + this.rectH / 2)} ` +
                `${(parentY + this.rectW / 2)},${(parentX + this.rectH / 2)} ${(parentY + this.rectW / 2)},` +
                `${(parentX + this.rectH / 2)}`;
        }
        return `M${(nodeX + this.rectW / 2)},${nodeY}C${(nodeX + this.rectW / 2)},${parentY} ` +
            `${(parentX + this.rectW / 2)},${(parentY + this.rectH / 2)} ${(parentX + this.rectW / 2)},` +
            `${(parentY + this.rectH / 2)}`;
    };
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiUGFyc2VUcmVlUmVuZGVyZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvd2Vidmlldy1zY3JpcHRzL1BhcnNlVHJlZVJlbmRlcmVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQTRCQSxNQUFNLE9BQU8saUJBQWlCO0lBQ1QsUUFBUSxHQUFHLEdBQUcsQ0FBQztJQUNmLEtBQUssR0FBRyxJQUFJLENBQUM7SUFDYixNQUFNLEdBQUcsSUFBSSxDQUFDO0lBRXZCLGNBQWMsR0FBRyxDQUFDLENBQUM7SUFDbkIsU0FBUyxHQUFHLEVBQUUsQ0FBQztJQUNmLFVBQVUsR0FBRyxHQUFHLENBQUM7SUFFakIsS0FBSyxHQUFHLEdBQUcsQ0FBQztJQUNaLEtBQUssR0FBRyxFQUFFLENBQUM7SUFFWCxJQUFJLENBQXVCO0lBRTNCLEdBQUcsQ0FBdUU7SUFDMUUsUUFBUSxDQUF1RTtJQUUvRSxJQUFJLENBQW9EO0lBQ3hELE9BQU8sQ0FBeUM7SUFDaEQsSUFBSSxDQUFzQztJQUUxQyxhQUFhLENBQXFCO0lBQ2xDLGFBQWEsQ0FBcUI7SUFFbEMsSUFBSSxDQUFpQjtJQUU3QjtRQUVJLElBQUksQ0FBQyxHQUFHLEdBQUcsRUFBRSxDQUFDLE1BQU0sQ0FBbUMsS0FBSyxDQUFDO2FBQ3hELElBQUksQ0FBQyxPQUFPLEVBQUUsNEJBQTRCLENBQUM7YUFDM0MsSUFBSSxDQUFDLFNBQVMsRUFBRSxLQUFLLENBQUM7YUFDdEIsSUFBSSxDQUFDLFNBQVMsRUFBRSxPQUFPLElBQUksQ0FBQyxLQUFLLElBQUksSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDLENBQUM7UUFFekQsSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBYSxHQUFHLENBQUMsQ0FBQztRQUVqRCxJQUFJLENBQUMsSUFBSSxHQUFHLEVBQUUsQ0FBQyxJQUFJLEVBQW9DO2FBQ2xELFdBQVcsQ0FBQyxDQUFDLElBQUksRUFBRSxDQUFDLENBQUMs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Q0FBQyxJQUFJLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDLEdBQUc7WUFDNUYsR0FBRyxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQyxFQUFFLENBQUM7SUFDeEMsQ0FBQyxDQUFDO0NBQ0wiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxyXG4gKiBDb3B5cmlnaHQgKGMpIE1pa2UgTGlzY2hrZS4gQWxsIHJpZ2h0cyByZXNlcnZlZC5cclxuICogTGljZW5zZWQgdW5kZXIgdGhlIE1JVCBMaWNlbnNlLiBTZWUgTGljZW5zZS50eHQgaW4gdGhlIHByb2plY3Qgcm9vdCBmb3IgbGljZW5zZSBpbmZvcm1hdGlvbi5cclxuICovXHJcblxyXG5pbXBvcnQgeyBJUGFyc2VUcmVlTm9kZSB9IGZyb20gXCIuL3R5cGVzXCI7XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIElSZW5kZXJlckRhdGEge1xyXG4gICAgcGFyc2VUcmVlRGF0YTogSVBhcnNlVHJlZU5vZGU7XHJcbiAgICB1c2VDbHVzdGVyOiBib29sZWFuO1xyXG4gICAgaG9yaXpvbnRhbDogYm9vbGVhbjtcclxuICAgIGluaXRpYWxTY2FsZTogbnVtYmVyO1xyXG4gICAgaW5pdGlhbFRyYW5zbGF0ZVg6IG51bWJlcjtcclxuICAgIGluaXRpYWxUcmFuc2xhdGVZOiBudW1iZXI7XHJcbn1cclxuXHJcbmludGVyZmFjZSBJUGFyc2VUcmVlUmVuZGVyTm9kZSBleHRlbmRzIElQYXJzZVRyZWVOb2RlIHtcclxuICAgIHgwPzogbnVtYmVyO1xyXG4gICAgeTA/OiBudW1iZXI7XHJcblxyXG4gICAgY2hpbGRyZW5CYWNrdXA/OiBQYXJzZVRyZWVMYXlvdXROb2RlW107XHJcbn1cclxuXHJcbi8vIFR5cGUgYWxpYXNlcyBmb3IgYmV0dGVyIGhhbmRsaW5nL3JlYWRpbmcuXHJcbnR5cGUgUGFyc2VUcmVlTGF5b3V0Tm9kZSA9IGQzLkhpZXJhcmNoeVBvaW50Tm9kZTxJUGFyc2VUcmVlUmVuZGVyTm9kZT47XHJcbnR5cGUgUGFyc2VUcmVlU2VsZWN0aW9uID0gZDMuU2VsZWN0aW9uPFNWR0VsZW1lbnQsIFBhcnNlVHJlZUxheW91dE5vZGUsIFNWR0VsZW1lbnQsIElQYXJzZVRyZWVSZW5kZXJOb2RlPjtcclxuXHJcbi8vIFRoZSBwYXJzZSB0cmVlIHJlbmRlcmVyIGlzIHVzZWQgaW4gd2Vidmlld3MgYXMgYSBzaW5nbGUgaW5zdGFuY2UgY2xhc3MuXHJcbmV4cG9ydCBjbGFzcyBQYXJzZVRyZWVSZW5kZXJlciB7XHJcbiAgICBwcml2YXRlIHJlYWRvbmx5IGR1cmF0aW9uID0gMjAwO1xyXG4gICAgcHJpdmF0ZSByZWFkb25seSB3aWR0aCA9IDEwMDA7XHJcbiAgICBwcml2YXRlIHJlYWRvbmx5IGhlaWdodCA9IDEwMDA7XHJcblxyXG4gICAgcHJpdmF0ZSBub2RlU2l6ZUZhY3RvciA9IDE7XHJcbiAgICBwcml2YXRlIG5vZGVXaWR0aCA9IDYwO1xyXG4gICAgcHJpdmF0ZSBub2RlSGVpZ2h0ID0gMTkwO1xyXG5cclxuICAgIHByaXZhdGUgcmVjdFcgPSAxODA7XHJcbiAgICBwcml2YXRlIHJlY3RIID0gMjM7XHJcblxyXG4gICAgcHJpdmF0ZSByb290PzogUGFyc2VUcmVlTGF5b3V0Tm9kZTtcclxuXHJcbiAgICBwcml2YXRlIHN2ZzogZDMuU2VsZWN0aW9uPFNWR0VsZW1lbnQsIElQYXJzZVRyZWVSZW5kZXJOb2RlLCBIVE1MRWxlbWVudCwgdW5rbm93bj47XHJcbiAgICBwcml2YXRlIHRvcEdyb3VwOiBkMy5TZWxlY3Rpb248U1ZHRWxlbWVudCwgSVBhcnNlVHJlZVJlbmRlck5vZGUsIEhUTUxFbGVtZW50LCB1bmtub3duPjtcclxuXHJcbiAgICBwcml2YXRlIHpvb206IGQzLlpvb21CZWhhdmlvcjxTVkdFbGVtZW50LCBJUGFyc2VUcmVlUmVuZGVyTm9kZT47XHJcbiAgICBwcml2YXRlIGNsdXN0ZXI6IGQzLkNsdXN0ZXJMYXlvdXQ8SVBhcnNlVHJlZVJlbmRlck5vZGU+O1xyXG4gICAgcHJpdmF0ZSB0cmVlOiBkMy5UcmVlTGF5b3V0PElQYXJzZVRyZWVSZW5kZXJOb2RlPjtcclxuXHJcbiAgICBwcml2YXRlIG5vZGVTZWxlY3Rpb246IFBhcnNlVHJlZVNlbGVjdGlvbjtcclxuICAgIHByaXZhdGUgbGlua1NlbGVjdGlvbjogUGFyc2VUcmVlU2VsZWN0aW9uO1xyXG5cclxuICAgIHByaXZhdGUgZGF0YT86IElSZW5kZXJlckRhdGE7XHJcblxyXG4gICAgcHVibGljIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgICAgIC8vIFRoZSBjYWxsaW5nIHdlYnBhZ2UgbXVzdCBkZWZpbmUgYW4gPHN2ZyAvPiBub2RlIGluIHRoZSBkb2N1bWVudC5cclxuICAgICAgICB0aGlzLnN2ZyA9IGQzLnNlbGVjdDxTVkdFbGVtZW50LCBJUGFyc2VUcmVlUmVuZGVyTm9kZT4oXCJzdmdcIilcclxuICAgICAgICAgICAgLmF0dHIoXCJ4bWxuc1wiLCBcImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnXCIpXHJcbiAgICAgICAgICAgIC5hdHRyKFwidmVyc2lvblwiLCBcIjEuMVwiKVxyXG4gICAgICAgICAgICAuYXR0cihcInZpZXdCb3hcIiwgYDAgMCAke3RoaXMud2lkdGh9ICR7dGhpcy5oZWlnaHR9YCk7XHJcblxyXG4gICAgICAgIHRoaXMudG9wR3JvdXAgPSB0aGlzLnN2Zy5hcHBlbmQ8U1ZHRWxlbWVudD4oXCJnXCIpO1xyXG5cclxuICAgICAgICB0aGlzLnpvb20gPSBkMy56b29tPFNWR0VsZW1lbnQsIElQYXJzZVRyZWVSZW5kZXJOb2RlPigpXHJcbiAgICAgICAgICAgIC5zY2FsZUV4dGVudChbMC4wMSwgM10pXHJcbiAgICAgICAgICAgIC5vbihcInpvb21cIiwgKGV2ZW50OiBkMy5EM1pvb21FdmVudDxTVkdFbGVtZW50LCBJUGFyc2VUcmVlUmVuZGVyTm9kZT4pID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMudG9wR3JvdXAuYXR0cihcInRyYW5zZm9ybVwiLCBldmVudC50cmFuc2Zvcm0udG9TdHJpbmcoKSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICB0aGlzLnRyZWUgPSBkMy50cmVlPElQYXJzZVRyZWVSZW5kZXJOb2RlPigpXHJcbiAgICAgICAgICAgIC5ub2RlU2l6ZShbdGhpcy5ub2RlV2lkdGgsIHRoaXMubm9kZUhlaWdodF0pXHJcbiAgICAgICAgICAgIC5zZXBhcmF0aW9uKChhLCBiKSA9PiB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gYS5wYXJlbnQgPT09IGIucGFyZW50ID8gMSA6IDEuNDtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHRoaXMuY2x1c3RlciA9IGQzLmNsdXN0ZXI8SVBhcnNlVHJlZVJlbmRlck5vZGU+KClcclxuICAgICAgICAgICAgLm5vZGVTaXplKFt0aGlzLm5vZGVXaWR0aCwgdGhpcy5ub2RlSGVpZ2h0XSlcclxuICAgICAgICAgICAgLnNlcGFyYXRpb24oKGEsIGIpID0+IHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBhLnBhcmVudCA9PT0gYi5wYXJlbnQgPyAxIDogMS40O1xyXG4gICAgICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEByZXR1cm5zIHRoZSBjdXJyZW50bHkgYWN0aXZlIHRvcCBsZXZlbCB0cmFuc2Zvcm1hdGlvbi5cclxuICAgICAqL1xyXG4gICAgcHVibGljIGdldCB0cmFuc2Zvcm0oKTogc3RyaW5nIHtcclxuICAgICAgICByZXR1cm4gdGhpcy50b3BHcm91cC5hdHRyKFwidHJhbnNmb3JtXCIpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogTG9hZCBuZXcgdHJlZSBkYXRhLCBidXQga2VlcCB0aGUgY3VycmVudCBkcmF3IG9mZnNldC5cclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gZGF0YSBUaGUgdHJlZSBkYXRhIHRvIGxvYWQuXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBsb2FkTmV3VHJlZShkYXRhOiBQYXJ0aWFsPElSZW5kZXJlckRhdGE+ICYgeyBwYXJzZVRyZWVEYXRhOiBJUGFyc2VUcmVlTm9kZTsgfSk6IHZvaWQge1xyXG4gICAgICAgIHRoaXMuZGF0YSA9IHtcclxuICAgICAgICAgICAgaG9yaXpvbnRhbDogdHJ1ZSxcclxuICAgICAgICAgICAgdXNlQ2x1c3RlcjogZmFsc2UsXHJcbiAgICAgICAgICAgIGluaXRpYWxUcmFuc2xhdGVYOiAyMDAsXHJcbiAgICAgICAgICAgIGluaXRpYWxUcmFuc2xhdGVZOiA0MDAsXHJcbiAgICAgICAgICAgIGluaXRpYWxTY2FsZTogMC43NSxcclxuICAgICAgICAgICAgLi4udGhpcy5kYXRhLFxyXG4gICAgICAgICAgICAuLi5kYXRhLFxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHRoaXMuc3ZnLmNhbGwodGhpcy56b29tKVxyXG4gICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L3VuYm91bmQtbWV0aG9kXHJcbiAgICAgICAgICAgIC5jYWxsKHRoaXMuem9vbS50cmFuc2Zvcm0sIGQzLnpvb21JZGVudGl0eVxyXG4gICAgICAgICAgICAgICAgLnRyYW5zbGF0ZSh0aGlzLmRhdGEuaW5pdGlhbFRyYW5zbGF0ZVggLSB0aGlzLnJlY3RXIC8gMiwgdGhpcy5kYXRhLmluaXRpYWxUcmFuc2xhdGVZKVxyXG4gICAgICAgICAgICAgICAgLnNjYWxlKHRoaXMuZGF0YS5pbml0aWFsU2NhbGUpLFxyXG4gICAgICAgICAgICApXHJcbiAgICAgICAgICAgIC5vbihcImRibGNsaWNrLnpvb21cIiwgbnVsbCk7XHJcblxyXG4gICAgICAgIHRoaXMubm9kZVdpZHRoID0gdGhpcy5kYXRhLmhvcml6b250YWwgPyA2MCA6IDE5MDtcclxuICAgICAgICB0aGlzLm5vZGVIZWlnaHQgPSB0aGlzLmRhdGEuaG9yaXpvbnRhbCA/IDE5MCA6IDYwO1xyXG5cclxuICAgICAgICBjb25zdCB4MCA9IHRoaXMucm9vdD8uZGF0YS54MCA/PyB0aGlzLndpZHRoIC8gMjtcclxuICAgICAgICBjb25zdCB5MCA9IHRoaXMucm9vdD8uZGF0YS55MCA/PyB0aGlzLmhlaWdodCAvIDI7XHJcblxyXG4gICAgICAgIC8vIGQzLmhpZXJhcmNoeSByZXR1cm5zIGEgbm9kZSB3aXRob3V0IGxheW91dCBjb29yZGluYXRlcywgc28gdGVjaG5pY2FsbHkgaXQncyBub3QgYSBwb2ludCBub2RlICh5ZXQpLlxyXG4gICAgICAgIC8vIEhvd2V2ZXIsIG9uY2UgdGhlIGxheW91dCBwcm9jZXNzIHdlbnQgdGhyb3VnaCBpdCBiZWNvbWVzIG9uZS5cclxuICAgICAgICB0aGlzLnJvb3QgPSBkMy5oaWVyYXJjaHk8SVBhcnNlVHJlZVJlbmRlck5vZGU+KHRoaXMuZGF0YS5wYXJzZVRyZWVEYXRhLCAobm9kZSkgPT4ge1xyXG4gICAgICAgICAgICByZXR1cm4gbm9kZS5jaGlsZHJlbjtcclxuICAgICAgICB9KSBhcyBQYXJzZVRyZWVMYXlvdXROb2RlO1xyXG5cclxuICAgICAgICBpZiAodGhpcy5kYXRhLnVzZUNsdXN0ZXIpIHtcclxuICAgICAgICAgICAgdGhpcy5jbHVzdGVyKHRoaXMucm9vdCk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy50cmVlKHRoaXMucm9vdCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLnJvb3QuZGF0YS54MCA9IHgwO1xyXG4gICAgICAgIHRoaXMucm9vdC5kYXRhLnkwID0geTA7XHJcblxyXG4gICAgICAgIHRoaXMudXBkYXRlTGF5b3V0cygpO1xyXG4gICAgICAgIHRoaXMudXBkYXRlKHRoaXMucm9vdCk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBQZXJmb3JtcyBhIHJlbGF0aXZlIHNpemUgY2hhbmdlIG9mIHRoZSBsYXlvdXQgbm9kZSBzaXplLlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBmYWN0b3IgVGhlIGZhY3RvciBmb3IgdGhlIHJlbGF0aXZlIGNoYW5nZS5cclxuICAgICAqL1xyXG4gICAgcHVibGljIGNoYW5nZU5vZGVTaXplKGZhY3RvcjogbnVtYmVyKTogdm9pZCB7XHJcbiAgICAgICAgaWYgKHRoaXMuZGF0YSkge1xyXG4gICAgICAgICAgICB0aGlzLm5vZGVTaXplRmFjdG9yICo9IGZhY3RvcjtcclxuXHJcbiAgICAgICAgICAgIGlmICh0aGlzLmRhdGEuaG9yaXpvbnRhbCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy50cmVlLm5vZGVTaXplKFt0aGlzLm5vZGVXaWR0aCwgdGhpcy5ub2RlSGVpZ2h0ICogdGhpcy5ub2RlU2l6ZUZhY3Rvcl0pO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jbHVzdGVyLm5vZGVTaXplKFt0aGlzLm5vZGVXaWR0aCwgdGhpcy5ub2RlSGVpZ2h0ICogdGhpcy5ub2RlU2l6ZUZhY3Rvcl0pO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5yZWN0VyA9IDAuOSAqIHRoaXMubm9kZUhlaWdodCAqIHRoaXMubm9kZVNpemVGYWN0b3I7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnRyZWUubm9kZVNpemUoW3RoaXMubm9kZVdpZHRoICogdGhpcy5ub2RlU2l6ZUZhY3RvciwgdGhpcy5ub2RlSGVpZ2h0XSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNsdXN0ZXIubm9kZVNpemUoW3RoaXMubm9kZVdpZHRoICogdGhpcy5ub2RlU2l6ZUZhY3RvciwgdGhpcy5ub2RlSGVpZ2h0XSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJlY3RXID0gMC45ICogdGhpcy5ub2RlV2lkdGggKiB0aGlzLm5vZGVTaXplRmFjdG9yO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB0aGlzLmFwcGx5TGF5b3V0Q2hhbmdlcygwLjUpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgdG9nZ2xlT3JpZW50YXRpb24oY2hlY2tib3g6IEhUTUxJbnB1dEVsZW1lbnQpOiB2b2lkIHtcclxuICAgICAgICBpZiAodGhpcy5kYXRhKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZGF0YS5ob3Jpem9udGFsID0gIWNoZWNrYm94LmNoZWNrZWQ7XHJcbiAgICAgICAgICAgIHRoaXMubm9kZVdpZHRoID0gdGhpcy5kYXRhLmhvcml6b250YWwgPyA2MCA6IDE5MDtcclxuICAgICAgICAgICAgdGhpcy5ub2RlSGVpZ2h0ID0gdGhpcy5kYXRhLmhvcml6b250YWwgPyAxOTAgOiA2MDtcclxuXHJcbiAgICAgICAgICAgIGlmICh0aGlzLmRhdGEuaG9yaXpvbnRhbCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy50cmVlLm5vZGVTaXplKFt0aGlzLm5vZGVXaWR0aCwgdGhpcy5ub2RlSGVpZ2h0ICogdGhpcy5ub2RlU2l6ZUZhY3Rvcl0pO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jbHVzdGVyLm5vZGVTaXplKFt0aGlzLm5vZGVXaWR0aCwgdGhpcy5ub2RlSGVpZ2h0ICogdGhpcy5ub2RlU2l6ZUZhY3Rvcl0pO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGhpcy50cmVlLm5vZGVTaXplKFt0aGlzLm5vZGVXaWR0aCAqIHRoaXMubm9kZVNpemVGYWN0b3IsIHRoaXMubm9kZUhlaWdodF0pO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jbHVzdGVyLm5vZGVTaXplKFt0aGlzLm5vZGVXaWR0aCAqIHRoaXMubm9kZVNpemVGYWN0b3IsIHRoaXMubm9kZUhlaWdodF0pO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB0aGlzLmFwcGx5TGF5b3V0Q2hhbmdlcygxKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHRvZ2dsZVRyZWVUeXBlKGNoZWNrYm94OiBIVE1MSW5wdXRFbGVtZW50KTogdm9pZCB7XHJcbiAgICAgICAgaWYgKHRoaXMuZGF0YSkge1xyXG4gICAgICAgICAgICB0aGlzLmRhdGEudXNlQ2x1c3RlciA9IGNoZWNrYm94LmNoZWNrZWQ7XHJcbiAgICAgICAgICAgIHRoaXMuYXBwbHlMYXlvdXRDaGFuZ2VzKDAuNSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBpbml0U3dpdGNoZXMoKTogdm9pZCB7XHJcbiAgICAgICAgY29uc3Qgc3dpdGNoMSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwic3dpdGNoMVwiKSBhcyBIVE1MSW5wdXRFbGVtZW50O1xyXG4gICAgICAgIGlmIChzd2l0Y2gxKSB7XHJcbiAgICAgICAgICAgIHN3aXRjaDEuY2hlY2tlZCA9IHRoaXMuZGF0YT8udXNlQ2x1c3RlciA/PyBmYWxzZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IHN3aXRjaDIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInN3aXRjaDJcIikgYXMgSFRNTElucHV0RWxlbWVudDtcclxuICAgICAgICBpZiAoc3dpdGNoMikge1xyXG4gICAgICAgICAgICBzd2l0Y2gyLmNoZWNrZWQgPSAhdGhpcy5kYXRhPy5ob3Jpem9udGFsID8/IHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgdXBkYXRlKHBhcmVudDogUGFyc2VUcmVlTGF5b3V0Tm9kZSk6IHZvaWQge1xyXG4gICAgICAgIGlmICghdGhpcy5kYXRhIHx8ICF0aGlzLnJvb3QpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3Qgc2l6ZSA9IHRoaXMuY2x1c3Rlci5ub2RlU2l6ZSgpID8/IFswLCAwXTsgLy8gW3dpZHRoLCBoZWlnaHRdXHJcblxyXG4gICAgICAgIHRoaXMucmVjdFcgPSAodGhpcy5kYXRhLmhvcml6b250YWwgPyBzaXplWzFdIDogc2l6ZVswXSkgKiAwLjk7XHJcblxyXG4gICAgICAgIGNvbnN0IGxheW91dE5vZGVzID0gdGhpcy5yb290LmRlc2NlbmRhbnRzKCk7XHJcbiAgICAgICAgdGhpcy5ub2RlU2VsZWN0aW9uID0gdGhpcy50b3BHcm91cC5zZWxlY3RBbGw8U1ZHRWxlbWVudCwgUGFyc2VUcmVlTGF5b3V0Tm9kZT4oXCIudHJlZS1ub2RlXCIpXHJcbiAgICAgICAgICAgIC5kYXRhKGxheW91dE5vZGVzLCAobm9kZSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG5vZGUuZGF0YS5pZDtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGNvbnN0IG5vZGVFbnRlciA9IHRoaXMubm9kZVNlbGVjdGlvbi5lbnRlcigpLmFwcGVuZDxTVkdFbGVtZW50PihcImdcIilcclxuICAgICAgICAgICAgLmF0dHIoXCJjbGFzc1wiLCAoZCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKCFkLnBhcmVudCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBcInRyZWUtbm9kZSB0cmVlLXJvb3RcIjtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBsZXQgcmVzdWx0ID0gXCJ0cmVlLW5vZGVcIjtcclxuICAgICAgICAgICAgICAgIHN3aXRjaCAoZC5kYXRhLnR5cGUpIHtcclxuICAgICAgICAgICAgICAgICAgICBjYXNlIFwidGVybWluYWxcIjoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gXCIgdHJlZS1sZWFmXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcImVycm9yXCI6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9IFwiIHRyZWUtZXJyb3JcIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsICgpID0+IHtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmRhdGE/Lmhvcml6b250YWwpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gYHRyYW5zbGF0ZSgke3BhcmVudC5kYXRhLnkwID8/IDB9LCAke3BhcmVudC5kYXRhLngwID8/IDB9KWA7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGB0cmFuc2xhdGUoJHtwYXJlbnQuZGF0YS54MCA/PyAwfSwgJHtwYXJlbnQuZGF0YS55MCA/PyAwfSlgO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAuc3R5bGUoXCJvcGFjaXR5XCIsIDApXHJcbiAgICAgICAgICAgIC5vbihcImNsaWNrXCIsIHRoaXMuY2xpY2spO1xyXG5cclxuICAgICAgICBub2RlRW50ZXIuYXBwZW5kKFwicmVjdFwiKVxyXG4gICAgICAgICAgICAuYXR0cihcIndpZHRoXCIsIHRoaXMucmVjdFcpXHJcbiAgICAgICAgICAgIC5hdHRyKFwiaGVpZ2h0XCIsIHRoaXMucmVjdEgpXHJcbiAgICAgICAgICAgIC5hdHRyKFwicnhcIiwgKGQpID0+IHtcclxuICAgICAgICAgICAgICAgIHJldHVybiAoZC5kYXRhLnR5cGUgPT09IFwicnVsZVwiKSA/IDAgOiAxMDtcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLmF0dHIoXCJyeVwiLCAoZCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIChkLmRhdGEudHlwZSA9PT0gXCJydWxlXCIpID8gMCA6IDEwO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgdGhpcy5jcmVhdGVUZXh0KG5vZGVFbnRlcik7XHJcbiAgICAgICAgdGhpcy51cGRhdGVFeGlzdGluZ05vZGVzKDEpO1xyXG5cclxuICAgICAgICAvLyBUcmFuc2l0aW9uIG5vZGVzIGFsc28gdG8gdGhlaXIgbmV3IHBvc2l0aW9uLlxyXG4gICAgICAgIHRoaXMubm9kZVNlbGVjdGlvblxyXG4gICAgICAgICAgICAudHJhbnNpdGlvbigpXHJcbiAgICAgICAgICAgIC5kdXJhdGlvbih0aGlzLmR1cmF0aW9uKVxyXG4gICAgICAgICAgICAuYXR0cihcInRyYW5zZm9ybVwiLCAobm9kZSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuZGF0YT8uaG9yaXpvbnRhbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBgdHJhbnNsYXRlKCR7bm9kZS55fSwgJHtub2RlLnh9KWA7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGB0cmFuc2xhdGUoJHtub2RlLnh9LCAke25vZGUueX0pYDtcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLnN0eWxlKFwib3BhY2l0eVwiLCAxKTtcclxuXHJcbiAgICAgICAgbm9kZUVudGVyLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgKG5vZGUpID0+IHtcclxuICAgICAgICAgICAgaWYgKHRoaXMuZGF0YT8uaG9yaXpvbnRhbCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGB0cmFuc2xhdGUoJHtub2RlLnkgPz8gMH0sICR7bm9kZS54ID8/IDB9KWA7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJldHVybiBgdHJhbnNsYXRlKCR7bm9kZS54ID8/IDB9LCAke25vZGUueSA/PyAwfSlgO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICAvLyBCeSB1c2luZyBhIHNsb3dlciB0cmFuc2l0aW9uIHRvIGZhZGUgaW4gdGhlIG5ldyBlbGVtZW50cyB3ZSBnaXZlIHRoZSB0cmVlIG1vcmUgdGltZSB0byBtYWtlIHJvb20gZm9yIHRoZW0uXHJcbiAgICAgICAgbm9kZUVudGVyLnRyYW5zaXRpb24oKVxyXG4gICAgICAgICAgICAuZHVyYXRpb24odGhpcy5kdXJhdGlvbiAqIDIpXHJcbiAgICAgICAgICAgIC5zdHlsZShcIm9wYWNpdHlcIiwgMSk7XHJcblxyXG4gICAgICAgIC8vIE5vZGVzIHRvIGJlIHJlbW92ZWQuXHJcbiAgICAgICAgdGhpcy5ub2RlU2VsZWN0aW9uLmV4aXQoKS50cmFuc2l0aW9uKClcclxuICAgICAgICAgICAgLmR1cmF0aW9uKHRoaXMuZHVyYXRpb24pXHJcbiAgICAgICAgICAgIC5zdHlsZShcIm9wYWNpdHlcIiwgMClcclxuICAgICAgICAgICAgLnJlbW92ZSgpO1xyXG5cclxuICAgICAgICB0aGlzLmxpbmtTZWxlY3Rpb24gPSB0aGlzLnRvcEdyb3VwLnNlbGVjdEFsbDxTVkdFbGVtZW50LCBQYXJzZVRyZWVMYXlvdXROb2RlPihcIi50cmVlLWxpbmtcIilcclxuICAgICAgICAgICAgLmRhdGEobGF5b3V0Tm9kZXMuc2xpY2UoMSksIChub2RlKSA9PiB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbm9kZS5kYXRhLmlkO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgLy8gT24gZXhwYW5kIChsaW5rcykuXHJcbiAgICAgICAgY29uc3QgbGlua0VudGVyID0gdGhpcy5saW5rU2VsZWN0aW9uLmVudGVyKCkuaW5zZXJ0KFwicGF0aFwiLCBcImdcIilcclxuICAgICAgICAgICAgLmF0dHIoXCJjbGFzc1wiLCBcInRyZWUtbGlua1wiKVxyXG4gICAgICAgICAgICAuYXR0cihcImRcIiwgdGhpcy5jb21wdXRlTGlua3MpXHJcbiAgICAgICAgICAgIC5zdHlsZShcInN0cm9rZS1vcGFjaXR5XCIsIDApO1xyXG5cclxuICAgICAgICAvLyBUcmFuc2l0aW9uIGV4aXN0aW5nIGxpbmtzIHRvIHRoZWlyIG5ldyBwb3NpdGlvbi5cclxuICAgICAgICB0aGlzLmxpbmtTZWxlY3Rpb25cclxuICAgICAgICAgICAgLnRyYW5zaXRpb24oKVxyXG4gICAgICAgICAgICAuZHVyYXRpb24odGhpcy5kdXJhdGlvbilcclxuICAgICAgICAgICAgLmF0dHIoXCJkXCIsIHRoaXMuY29tcHV0ZUxpbmtzKS5zdHlsZShcInN0cm9rZS1vcGFjaXR5XCIsIDEpO1xyXG5cclxuICAgICAgICAvLyBGYWRlIGluIG5ldyBsaW5rcy5cclxuICAgICAgICBsaW5rRW50ZXJcclxuICAgICAgICAgICAgLnRyYW5zaXRpb24oKVxyXG4gICAgICAgICAgICAuZHVyYXRpb24odGhpcy5kdXJhdGlvbiAqIDIpXHJcbiAgICAgICAgICAgIC5zdHlsZShcInN0cm9rZS1vcGFjaXR5XCIsIDEpO1xyXG5cclxuICAgICAgICAvLyBGYWRlIG91dCBhbmQgcmVtb3ZlIG9sZCBsaW5rcy5cclxuICAgICAgICB0aGlzLmxpbmtTZWxlY3Rpb24uZXhpdCgpXHJcbiAgICAgICAgICAgIC50cmFuc2l0aW9uKClcclxuICAgICAgICAgICAgLmR1cmF0aW9uKHRoaXMuZHVyYXRpb24pXHJcbiAgICAgICAgICAgIC5zdHlsZShcInN0cm9rZS1vcGFjaXR5XCIsIDApXHJcbiAgICAgICAgICAgIC5yZW1vdmUoKTtcclxuXHJcbiAgICAgICAgdGhpcy5ub2RlU2VsZWN0aW9uID0gdGhpcy50b3BHcm91cC5zZWxlY3RBbGwoXCIudHJlZS1ub2RlXCIpO1xyXG4gICAgICAgIHRoaXMubGlua1NlbGVjdGlvbiA9IHRoaXMudG9wR3JvdXAuc2VsZWN0QWxsKFwiLnRyZWUtbGlua1wiKTtcclxuXHJcbiAgICAgICAgLy8gU3Rhc2ggdGhlIG9sZCBwb3NpdGlvbnMgZm9yIHRyYW5zaXRpb24uXHJcbiAgICAgICAgbGF5b3V0Tm9kZXMuZm9yRWFjaCgobm9kZSkgPT4ge1xyXG4gICAgICAgICAgICBub2RlLmRhdGEueDAgPSBub2RlLng7XHJcbiAgICAgICAgICAgIG5vZGUuZGF0YS55MCA9IG5vZGUueTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIFVwZGF0ZXMgdGhlIGNsdXN0ZXIgYW5kIHRyZWUgbGF5b3V0cyB3aXRoIHRoZSBjdXJyZW50IG5vZGUgc2l6ZXMuXHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgdXBkYXRlTGF5b3V0cygpOiB2b2lkIHtcclxuICAgICAgICBpZiAodGhpcy5kYXRhKSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmRhdGEuaG9yaXpvbnRhbCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5yZWN0VyA9IHRoaXMubm9kZUhlaWdodCAqIHRoaXMubm9kZVNpemVGYWN0b3I7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnRyZWUubm9kZVNpemUoW3RoaXMubm9kZVdpZHRoLCB0aGlzLnJlY3RXXSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNsdXN0ZXIubm9kZVNpemUoW3RoaXMubm9kZVdpZHRoLCB0aGlzLnJlY3RXXSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJlY3RXID0gdGhpcy5ub2RlV2lkdGggKiB0aGlzLm5vZGVTaXplRmFjdG9yO1xyXG4gICAgICAgICAgICAgICAgdGhpcy50cmVlLm5vZGVTaXplKFt0aGlzLnJlY3RXLCB0aGlzLm5vZGVIZWlnaHRdKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuY2x1c3Rlci5ub2RlU2l6ZShbdGhpcy5yZWN0VywgdGhpcy5ub2RlSGVpZ2h0XSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBSZS1yZW5kZXIgdGhlIGhpZXJhcmNoeSBhZnRlciBjaGFuZ2luZyBsYXlvdXQgcmVsYXRlZCBzZXR0aW5ncy5cclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gZHVyYXRpb25GYWN0b3IgQSB0aW1pbmcgZmFjdG9yIHdoaWNoIGRldGVybWluZXMgaG93IHF1aWNrIGFuaW1hdGlvbnMgc2hvdWxkIHJ1bi5cclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSBhcHBseUxheW91dENoYW5nZXMoZHVyYXRpb25GYWN0b3I6IG51bWJlcik6IHZvaWQge1xyXG4gICAgICAgIGlmICghdGhpcy5kYXRhIHx8ICF0aGlzLnJvb3QpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHRoaXMuZGF0YS51c2VDbHVzdGVyKSB7XHJcbiAgICAgICAgICAgIHRoaXMuY2x1c3Rlcih0aGlzLnJvb3QpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMudHJlZSh0aGlzLnJvb3QpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLnVwZGF0ZUV4aXN0aW5nTm9kZXMoZHVyYXRpb25GYWN0b3IpO1xyXG5cclxuICAgICAgICB0aGlzLm5vZGVTZWxlY3Rpb25cclxuICAgICAgICAgICAgLnRyYW5zaXRpb24oKVxyXG4gICAgICAgICAgICAuZHVyYXRpb24odGhpcy5kdXJhdGlvbiAqIGR1cmF0aW9uRmFjdG9yKVxyXG4gICAgICAgICAgICAuYXR0cihcInRyYW5zZm9ybVwiLCAobm9kZSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuZGF0YT8uaG9yaXpvbnRhbCA/PyB0cnVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGB0cmFuc2xhdGUoJHtub2RlLnkgPz8gMH0sICR7bm9kZS54ID8/IDB9KWA7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGB0cmFuc2xhdGUoJHtub2RlLnggPz8gMH0sICR7bm9kZS55ID8/IDB9KWA7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICB0aGlzLmxpbmtTZWxlY3Rpb25cclxuICAgICAgICAgICAgLnRyYW5zaXRpb24oKVxyXG4gICAgICAgICAgICAuZHVyYXRpb24odGhpcy5kdXJhdGlvbiAqIGR1cmF0aW9uRmFjdG9yKVxyXG4gICAgICAgICAgICAuYXR0cihcImRcIiwgdGhpcy5jb21wdXRlTGlua3MpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogVXBkYXRlcyBhbGwgZXhpc3Rpbmcgbm9kZXMgYW5kIHRoZWlyIHN1Yi1lbGVtZW50cy5cclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gZHVyYXRpb25GYWN0b3IgQSB0aW1pbmcgZmFjdG9yIHdoaWNoIGRldGVybWluZXMgaG93IHF1aWNrIGFuaW1hdGlvbnMgc2hvdWxkIHJ1bi5cclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSB1cGRhdGVFeGlzdGluZ05vZGVzKGR1cmF0aW9uRmFjdG9yOiBudW1iZXIpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLm5vZGVTZWxlY3Rpb25cclxuICAgICAgICAgICAgLnRyYW5zaXRpb24oKVxyXG4gICAgICAgICAgICAuZHVyYXRpb24odGhpcy5kdXJhdGlvbiAqIGR1cmF0aW9uRmFjdG9yKVxyXG4gICAgICAgICAgICAuYXR0cihcImNsYXNzXCIsIChkKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIWQucGFyZW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwidHJlZS1ub2RlIHRyZWUtcm9vdFwiO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGxldCByZXN1bHQgPSBcInRyZWUtbm9kZVwiO1xyXG4gICAgICAgICAgICAgICAgc3dpdGNoIChkLmRhdGEudHlwZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJ0ZXJtaW5hbFwiOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSBcIiB0cmVlLWxlYWZcIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJlcnJvclwiOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSBcIiB0cmVlLWVycm9yXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgY29uc3QgcmVjdFcgPSB0aGlzLnJlY3RXO1xyXG4gICAgICAgIHRoaXMubm9kZVNlbGVjdGlvbi5zZWxlY3Q8U1ZHRWxlbWVudD4oXCJyZWN0XCIpXHJcbiAgICAgICAgICAgIC50cmFuc2l0aW9uKClcclxuICAgICAgICAgICAgLmR1cmF0aW9uKHRoaXMuZHVyYXRpb24gKiBkdXJhdGlvbkZhY3RvcilcclxuICAgICAgICAgICAgLmF0dHIoXCJ3aWR0aFwiLCByZWN0Vyk7XHJcblxyXG4gICAgICAgIHRoaXMubm9kZVNlbGVjdGlvbi5zZWxlY3Q8U1ZHVGV4dEVsZW1lbnQ+KFwiLm5vZGUtdGV4dFwiKVxyXG4gICAgICAgICAgICAudHJhbnNpdGlvbigpXHJcbiAgICAgICAgICAgIC5kdXJhdGlvbih0aGlzLmR1cmF0aW9uICogZHVyYXRpb25GYWN0b3IpXHJcbiAgICAgICAgICAgIC5hdHRyKFwieFwiLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gKHJlY3RXIC0gdGhpcy5nZXRDb21wdXRlZFRleHRMZW5ndGgoKSkgLyAyO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgY29uc3QgaXNIb3Jpem9udGFsID0gdGhpcy5kYXRhPy5ob3Jpem9udGFsID8/IHRydWU7XHJcbiAgICAgICAgdGhpcy5ub2RlU2VsZWN0aW9uLnNlbGVjdDxTVkdUZXh0RWxlbWVudD4oXCIudG9rZW4tdmFsdWVcIilcclxuICAgICAgICAgICAgLnRyYW5zaXRpb24oKVxyXG4gICAgICAgICAgICAuZHVyYXRpb24odGhpcy5kdXJhdGlvbiAqIGR1cmF0aW9uRmFjdG9yKVxyXG4gICAgICAgICAgICAuYXR0cihcImR4XCIsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBpc0hvcml6b250YWwgPyByZWN0VyArIDIwIDogKHJlY3RXIC0gdGhpcy5nZXRDb21wdXRlZFRleHRMZW5ndGgoKSkgLyAyO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAuYXR0cihcImR5XCIsICgpID0+IHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBpc0hvcml6b250YWwgPyBcIjAuMjVlbVwiIDogXCIyLjVlbVwiO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAudGV4dCgoZCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKGQuZGF0YS50eXBlID09PSBcInJ1bGVcIikge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBcIlwiO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGlmIChkLmRhdGEudHlwZSA9PT0gXCJlcnJvclwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFkLmRhdGEuc3ltYm9sIHx8IGQuZGF0YS5zeW1ib2wudG9rZW5JbmRleCA9PT0gLTEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwiPG1pc3Npbmc+XCI7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gYDx1bmV4cGVjdGVkOiAke2QuZGF0YS5zeW1ib2wudGV4dH0+YDtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZC5kYXRhLnN5bWJvbD8udGV4dCA/PyBcIlwiO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgdGhpcy5ub2RlU2VsZWN0aW9uLnNlbGVjdChcIi50b2tlbi1yYW5nZVwiKVxyXG4gICAgICAgICAgICAudHJhbnNpdGlvbigpXHJcbiAgICAgICAgICAgIC5kdXJhdGlvbih0aGlzLmR1cmF0aW9uICogZHVyYXRpb25GYWN0b3IpXHJcbiAgICAgICAgICAgIC50ZXh0KChkKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAoZC5kYXRhLnR5cGUgIT09IFwicnVsZVwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFkLmRhdGEuc3ltYm9sIHx8IGQuZGF0YS5zeW1ib2wudG9rZW5JbmRleCA9PT0gLTEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwibm8gaW5kZXhcIjtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBgXFx1MkEzMyAke2QuZGF0YS5zeW1ib2wudG9rZW5JbmRleH1gO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGlmICghZC5kYXRhLnJhbmdlIHx8IGQuZGF0YS5yYW5nZS5sZW5ndGggPT09IDApIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gXCJcXHUyQTMzIC0tXCI7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKGQuZGF0YS5yYW5nZS5sZW5ndGggPT09IDEpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gYFxcdTJBMzMgJHtkLmRhdGEucmFuZ2Uuc3RhcnRJbmRleH1gO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHJldHVybiBgXFx1MkEzMyAke2QuZGF0YS5yYW5nZS5zdGFydEluZGV4fS0ke2QuZGF0YS5yYW5nZS5zdG9wSW5kZXh9YDtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBIaWRlIG9yIHNob3cgY2hpbGQgbm9kZXMgb24gYSBjbGljay5cclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gX2V2ZW50IFRoZSBjbGljayBldmVudCBkYXRhLlxyXG4gICAgICogQHBhcmFtIG5vZGUgVGhlIGhpZXJhcmNoeSBub2RlIG9uIHdoaWNoIHRoZSB1c2VyIGNsaWNrZWQuXHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgY2xpY2sgPSAoX2V2ZW50OiBNb3VzZUV2ZW50LCBub2RlOiBQYXJzZVRyZWVMYXlvdXROb2RlKTogdm9pZCA9PiB7XHJcbiAgICAgICAgaWYgKG5vZGUuY2hpbGRyZW4pIHtcclxuICAgICAgICAgICAgbm9kZS5kYXRhLmNoaWxkcmVuQmFja3VwID0gbm9kZS5jaGlsZHJlbjtcclxuICAgICAgICAgICAgbm9kZS5jaGlsZHJlbiA9IHVuZGVmaW5lZDtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBub2RlLmNoaWxkcmVuID0gbm9kZS5kYXRhLmNoaWxkcmVuQmFja3VwO1xyXG4gICAgICAgICAgICBub2RlLmRhdGEuY2hpbGRyZW5CYWNrdXAgPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGhpcy5kYXRhICYmIHRoaXMucm9vdCkge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5kYXRhLnVzZUNsdXN0ZXIpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuY2x1c3Rlcih0aGlzLnJvb3QpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGhpcy50cmVlKHRoaXMucm9vdCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHRoaXMudXBkYXRlKG5vZGUpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgcHJpdmF0ZSBjcmVhdGVUZXh0KG5vZGVFbnRlcjogUGFyc2VUcmVlU2VsZWN0aW9uKTogdm9pZCB7XHJcbiAgICAgICAgLy8gVGhlIG5vZGUncyB0ZXh0LlxyXG4gICAgICAgIGxldCBub2RlVGV4dCA9IG5vZGVFbnRlci5hcHBlbmQoXCJ0ZXh0XCIpXHJcbiAgICAgICAgICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJub2RlLXRleHRcIilcclxuICAgICAgICAgICAgLmF0dHIoXCJ5XCIsIHRoaXMucmVjdEggLyAyKVxyXG4gICAgICAgICAgICAuYXR0cihcImR5XCIsIFwiLjM1ZW1cIilcclxuICAgICAgICAgICAgLnRleHQoKG5vZGUpID0+IHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBub2RlLmRhdGEubmFtZTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIC8vIFRoZSBib3VuZGluZyBib3ggaXMgdmFsaWQgbm90IGJlZm9yZSB0aGUgbm9kZSBhZGRpdGlvbiBoYXBwZW5lZCBhY3R1YWxseS5cclxuICAgICAgICBub2RlVGV4dC5hdHRyKFwieFwiLCAobm9kZSwgaW5kZXgsIGxpc3QpID0+IHtcclxuICAgICAgICAgICAgcmV0dXJuICh0aGlzLnJlY3RXIC0gbGlzdFtpbmRleF0uZ2V0Q29tcHV0ZWRUZXh0TGVuZ3RoKCkpIC8gMjtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgLy8gVGhlIG5vZGUncyB0b2tlbiBpbmRleC9yYW5nZSBpbmZvLlxyXG4gICAgICAgIG5vZGVFbnRlci5hcHBlbmQoXCJ0ZXh0XCIpXHJcbiAgICAgICAgICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJ0b2tlbi1yYW5nZVwiKVxyXG4gICAgICAgICAgICAuYXR0cihcInhcIiwgMClcclxuICAgICAgICAgICAgLmF0dHIoXCJ5XCIsIHRoaXMucmVjdEggLyAyKVxyXG4gICAgICAgICAgICAuYXR0cihcImR4XCIsIDApXHJcbiAgICAgICAgICAgIC5hdHRyKFwiZHlcIiwgXCItMS44ZW1cIilcclxuICAgICAgICAgICAgLnRleHQoKG5vZGUpID0+IHtcclxuICAgICAgICAgICAgICAgIGlmIChub2RlLmRhdGEudHlwZSAhPT0gXCJydWxlXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAobm9kZS5kYXRhLnN5bWJvbD8udG9rZW5JbmRleCA9PT0gLTEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwibm8gaW5kZXhcIjtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBgXFx1MkEzMyAke25vZGUuZGF0YS5zeW1ib2w/LnRva2VuSW5kZXggPz8gLTF9YDtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoIW5vZGUuZGF0YS5yYW5nZSB8fCBub2RlLmRhdGEucmFuZ2UubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwiXFx1MkEzMyAtLVwiO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGlmIChub2RlLmRhdGEucmFuZ2UubGVuZ3RoID09PSAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGBcXHUyQTMzICR7bm9kZS5kYXRhLnJhbmdlLnN0YXJ0SW5kZXh9YDtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gYFxcdTJBMzMgJHtub2RlLmRhdGEucmFuZ2Uuc3RhcnRJbmRleH0gLSAke25vZGUuZGF0YS5yYW5nZS5zdG9wSW5kZXh9YDtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIC8vIFRoZSBub2RlJ3MgY29udGVudCBpZiB0aGlzIGl0IGlzIGEgdGVybWluYWwuXHJcbiAgICAgICAgbm9kZVRleHQgPSBub2RlRW50ZXIuYXBwZW5kKFwidGV4dFwiKVxyXG4gICAgICAgICAgICAuYXR0cihcImNsYXNzXCIsIFwidG9rZW4tdmFsdWVcIilcclxuICAgICAgICAgICAgLmF0dHIoXCJ4XCIsIDApXHJcbiAgICAgICAgICAgIC5hdHRyKFwieVwiLCB0aGlzLnJlY3RIIC8gMilcclxuICAgICAgICAgICAgLmF0dHIoXCJkeVwiLCB0aGlzLmRhdGE/Lmhvcml6b250YWwgPz8gdHJ1ZSA/IFwiMC4yNWVtXCIgOiBcIjIuNWVtXCIpXHJcbiAgICAgICAgICAgIC50ZXh0KChub2RlKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAobm9kZS5kYXRhLnR5cGUgPT09IFwicnVsZVwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwiXCI7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKG5vZGUuZGF0YS50eXBlID09PSBcImVycm9yXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIW5vZGUuZGF0YS5zeW1ib2wgfHwgbm9kZS5kYXRhLnN5bWJvbC50b2tlbkluZGV4ID09PSAtMSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gXCI8bWlzc2luZz5cIjtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBgPHVuZXhwZWN0ZWQ6ICR7bm9kZS5kYXRhLnN5bWJvbC50ZXh0fT5gO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHJldHVybiBub2RlLmRhdGEuc3ltYm9sPy50ZXh0ID8/IFwiXCI7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICBub2RlVGV4dC5hdHRyKFwiZHhcIiwgKG5vZGUsIGluZGV4LCBsaXN0KSA9PiB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmRhdGE/Lmhvcml6b250YWwgPz8gdHJ1ZVxyXG4gICAgICAgICAgICAgICAgPyB0aGlzLnJlY3RXICsgMjBcclxuICAgICAgICAgICAgICAgIDogKHRoaXMucmVjdFcgLSBsaXN0W2luZGV4XS5nZXRDb21wdXRlZFRleHRMZW5ndGgoKSkgLyAyO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgY29tcHV0ZUxpbmtzID0gKG5vZGU6IFBhcnNlVHJlZUxheW91dE5vZGUpID0+IHtcclxuICAgICAgICBjb25zdCBwYXJlbnRYID0gbm9kZS5wYXJlbnQ/LnggPz8gMDtcclxuICAgICAgICBjb25zdCBwYXJlbnRZID0gbm9kZS5wYXJlbnQ/LnkgPz8gMDtcclxuICAgICAgICBjb25zdCBub2RlWCA9IG5vZGUueDtcclxuICAgICAgICBjb25zdCBub2RlWSA9IG5vZGUueTtcclxuXHJcbiAgICAgICAgaWYgKHRoaXMuZGF0YT8uaG9yaXpvbnRhbCA/PyB0cnVlKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHkgPSBwYXJlbnRZICsgdGhpcy5yZWN0VyAvIDI7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gYE0ke25vZGVZfSwkeyhub2RlWCArIHRoaXMucmVjdEggLyAyKX1DJHt5fSwkeyhub2RlWCArIHRoaXMucmVjdEggLyAyKX0gYCArXHJcbiAgICAgICAgICAgICAgICBgJHsocGFyZW50WSArIHRoaXMucmVjdFcgLyAyKX0sJHsocGFyZW50WCArIHRoaXMucmVjdEggLyAyKX0gJHsocGFyZW50WSArIHRoaXMucmVjdFcgLyAyKX0sYCArXHJcbiAgICAgICAgICAgICAgICBgJHsocGFyZW50WCArIHRoaXMucmVjdEggLyAyKX1gO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIGBNJHsobm9kZVggKyB0aGlzLnJlY3RXIC8gMil9LCR7bm9kZVl9QyR7KG5vZGVYICsgdGhpcy5yZWN0VyAvIDIpfSwke3BhcmVudFl9IGAgK1xyXG4gICAgICAgICAgICBgJHsocGFyZW50WCArIHRoaXMucmVjdFcgLyAyKX0sJHsocGFyZW50WSArIHRoaXMucmVjdEggLyAyKX0gJHsocGFyZW50WCArIHRoaXMucmVjdFcgLyAyKX0sYCArXHJcbiAgICAgICAgICAgIGAkeyhwYXJlbnRZICsgdGhpcy5yZWN0SCAvIDIpfWA7XHJcbiAgICB9O1xyXG59XHJcbiJdfQ==